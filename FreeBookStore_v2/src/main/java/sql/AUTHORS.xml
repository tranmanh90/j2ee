<?xml version="1.0" encoding="UTF-8"?>

<dbQuery category="AUTHORS">

	<!-- Search author by name -->
	<select id="s000">
			DECLARE @PageIndex INT, @RowsPerPage INT, @StartRow INT, @EndRow INT;
			SET @PageIndex = ?;
			SET @RowsPerPage = ?;
			SET @StartRow = ((@PageIndex - 1) * @RowsPerPage) + 1;
			SET @EndRow = @StartRow + @RowsPerPage - 1;

			DECLARE @ParamAuthorName NVARCHAR(50);
			SET @ParamAuthorName = LTRIM(RTRIM(?));
			
			WITH pageinfo AS ( SELECT *, ROW_NUMBER() OVER(ORDER BY AUTHOR_ID ASC) AS ROW_NO, COUNT(*) OVER() AS TOTAL_ROWS 
			FROM( 
			-- WORKING QUERY
			SELECT	AU.AUTHOR_ID,
					AU.AUTHOR_NAME,
					AU.AUTHOR_ABOUT
			FROM	AUTHORS AU
			WHERE	AU.AUTHOR_NAME  LIKE '%' + @ParamAuthorName + '%'
			-- WORKING QUERY
			) AS Src)
			SELECT *, CEILING(TOTAL_ROWS/ CAST(@RowsPerPage AS DECIMAL(20,2))) AS TOTAL_PAGES, @PageIndex AS PAGE_INDEX
			FROM pageinfo
			WHERE ROW_NO BETWEEN @StartRow AND @EndRow
	</select>

	<!-- Search author by id -->
	<select id="s001">

	</select>
</dbQuery>